<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Advanced Text Editor (Glitch-Free)</title>
<style>
    body {
        margin: 0;
        background: #1e1e1e;
        color: #d4d4d4;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        height: 100vh;
        display: flex;
        flex-direction: column;
    }
    header {
        background: #252525;
        padding: 10px;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    input, select, button {
        background: #2d2d2d;
        color: #fff;
        border: none;
        padding: 6px 10px;
        border-radius: 4px;
    }
    button {
        background: #2f71b4;
        cursor: pointer;
    }
    button:hover {
        background: #3a8bc9;
    }
    .editor-container {
        flex: 1;
        display: flex;
        overflow: hidden;
    }
    .code-wrapper {
        flex: 1;
        position: relative;
        background: #1e1e1e;
    }
    /* Textarea sits on top, transparent background, for input */
    textarea {
        position: absolute;
        top: 0; left: 0;
        width: 100%;
        height: 100%;
        background: transparent;
        color: transparent;
        caret-color: white;
        border: none;
        resize: none;
        font-family: 'Fira Code', monospace;
        font-size: 14px;
        line-height: 1.5;
        padding: 20px;
        white-space: pre;
        overflow: auto;
        z-index: 2;
    }
    /* Highlight layer underneath */
    pre {
        margin: 0;
        pointer-events: none;
        padding: 20px;
        font-family: 'Fira Code', monospace;
        font-size: 14px;
        line-height: 1.5;
        white-space: pre-wrap;
        word-wrap: break-word;
    }
    .keyword { color: #569cd6; }
    .string { color: #ce9178; }
    .comment { color: #6a9955; }
    .number { color: #b5cea8; }
    .html-tag { color: #569cd6; }
    .css-property { color: #d7ba7d; }
</style>
</head>
<body>

<header>
    <input type="text" id="searchInput" placeholder="Search...">
    <input type="text" id="replaceInput" placeholder="Replace with...">
    <button id="replaceBtn">Replace Selected</button>
    <button id="replaceAllBtn">Replace All</button>
    <select id="languageSelector">
        <option value="javascript">JavaScript</option>
        <option value="html">HTML</option>
        <option value="css">CSS</option>
    </select>
</header>

<div class="editor-container">
    <div class="code-wrapper">
        <textarea id="codeInput">// Example code
function hello() {
    console.log("Hello, World!");
}
hello();</textarea>
        <pre id="highlightLayer"></pre>
    </div>
</div>

<script>
const textarea = document.getElementById("codeInput");
const highlightLayer = document.getElementById("highlightLayer");
const langSelect = document.getElementById("languageSelector");
const searchInput = document.getElementById("searchInput");
const replaceInput = document.getElementById("replaceInput");
const replaceBtn = document.getElementById("replaceBtn");
const replaceAllBtn = document.getElementById("replaceAllBtn");

function highlight(code, lang) {
    code = code
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;");

    if (lang === "javascript") {
        code = code
            .replace(/(\/\/.*)/g, '<span class="comment">$1</span>')
            .replace(/(".*?"|'.*?')/g, '<span class="string">$1</span>')
            .replace(/\b(function|return|const|let|var|console|log)\b/g, '<span class="keyword">$1</span>')
            .replace(/\b(\d+)\b/g, '<span class="number">$1</span>');
    } 
    else if (lang === "html") {
        code = code
            .replace(/(&lt;\/?\w+.*?&gt;)/g, '<span class="html-tag">$1</span>');
    } 
    else if (lang === "css") {
        code = code
            .replace(/(\.\w+)/g, '<span class="css-property">$1</span>')
            .replace(/(#[\w-]+)/g, '<span class="css-property">$1</span>');
    }

    return code;
}

function updateHighlight() {
    const code = textarea.value;
    highlightLayer.innerHTML = highlight(code, langSelect.value);
}

textarea.addEventListener("input", updateHighlight);
langSelect.addEventListener("change", updateHighlight);

// Replace selected text
replaceBtn.addEventListener("click", () => {
    const start = textarea.selectionStart;
    const end = textarea.selectionEnd;
    const text = textarea.value;
    textarea.value = text.slice(0, start) + replaceInput.value + text.slice(end);
    updateHighlight();
});

// Replace all occurrences
replaceAllBtn.addEventListener("click", () => {
    const searchTerm = searchInput.value;
    if (!searchTerm) return;
    const regex = new RegExp(searchTerm.replace(/[.*+?^${}()|[\]\\]/g, "\\$&"), "g");
    textarea.value = textarea.value.replace(regex, replaceInput.value);
    updateHighlight();
});

// Initialize
updateHighlight();
</script>

</body>
</html>